<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evil Manager and the Long Form</title>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>

  <!-- Emotion (required for MUI) -->
  <script crossorigin src="https://unpkg.com/@emotion/react@11.11.3/dist/emotion-react.umd.min.js"></script>
  <script crossorigin src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>

  <!-- Material UI -->
  <script crossorigin src="https://unpkg.com/@mui/material@5.15.11/umd/material-ui.development.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />

  <!-- Sweet Alert 2 instead of React-Toastify -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Custom Styles -->
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .form-container {
      max-width: 1024px;
      width: 100%;
      background: white;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .form-title {
      text-align: center;
      margin-bottom: 2rem;
      color: #1976d2;
      font-size: 2rem;
      font-weight: bold;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .form-field {
      transition: transform 0.2s ease;
    }

    .form-field:hover {
      transform: translateY(-2px);
    }

    .submit-button {
      margin-top: 2rem !important;
      width: 100%;
      height: 48px;
    }

    @keyframes loading {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 10px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: loading 1s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- App Script -->
  <script type="text/babel">
    const { 
      Button, TextField, Select, MenuItem, FormControl, 
      InputLabel, FormHelperText, CircularProgress 
    } = MaterialUI;

    // Field configuration array: each field has name, label, type, validation rules, etc.
    const fieldConfig = [
      { name: 'firstName', label: 'First Name', type: 'text', required: true, minLength: 2 },
      { name: 'lastName', label: 'Last Name', type: 'text', required: true, minLength: 2 },
      { name: 'email', label: 'Email', type: 'email', required: true, pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
      { name: 'phone', label: 'Phone', type: 'tel', required: true, pattern: /^\+?\d{10,15}$/ },
      { name: 'age', label: 'Age', type: 'number', required: true, min: 18, max: 120 },
      { name: 'address', label: 'Address', type: 'text', required: true, minLength: 5 },
      { name: 'city', label: 'City', type: 'text', required: true },
      { name: 'country', label: 'Country', type: 'text', required: true },
      { name: 'zipCode', label: 'Zip Code', type: 'text', required: true, pattern: /^\d{5}(-\d{4})?$/ },
      { name: 'occupation', label: 'Occupation', type: 'text', required: false },
      { name: 'company', label: 'Company', type: 'text', required: false },
      { name: 'website', label: 'Website', type: 'url', required: false, pattern: /^https?:\/\/.+/ },
      { name: 'birthDate', label: 'Birth Date', type: 'date', required: true },
      { name: 'gender', label: 'Gender', type: 'select', required: true, options: ['Male', 'Female', 'Other'] },
      { name: 'nationality', label: 'Nationality', type: 'text', required: true },
      { name: 'emergencyContact', label: 'Emergency Contact', type: 'tel', required: true, pattern: /^\+?\d{10,15}$/ },
      { name: 'hobbies', label: 'Hobbies', type: 'text', required: false },
      { name: 'education', label: 'Education', type: 'text', required: true },
      { name: 'language', label: 'Language', type: 'text', required: true },
      { name: 'comments', label: 'Comments', type: 'textarea', required: false, maxLength: 500 },
    ];

    // Generic validation function for all fields
    function validateField(field, value) {
      // Required field validation
      if (field.required && (!value || value.toString().trim() === '')) {
        return `${field.label} is required.`;
      }

      // Text length validations
      if (field.minLength && value && value.length < field.minLength) {
        return `${field.label} must be at least ${field.minLength} characters.`;
      }
      if (field.maxLength && value && value.length > field.maxLength) {
        return `${field.label} must be at most ${field.maxLength} characters.`;
      }

      // Type-specific validations
      if (field.type === 'email' && value && !/^\S+@\S+\.\S+$/.test(value)) {
        return 'Please enter a valid email address.';
      }
      if (field.type === 'tel' && value && !/^\+?\d{10,15}$/.test(value)) {
        return 'Please enter a valid phone number (10-15 digits, optional +).';
      }
      if (field.type === 'url' && value && !/^https?:\/\/.+/.test(value)) {
        return 'Please enter a valid URL (starting with http:// or https://).';
      }

      // Numeric range validations
      if (field.type === 'number' && value) {
        const num = Number(value);
        if (isNaN(num)) return `${field.label} must be a number.`;
        if (field.min !== undefined && num < field.min) {
          return `${field.label} must be at least ${field.min}.`;
        }
        if (field.max !== undefined && num > field.max) {
          return `${field.label} must be at most ${field.max}.`;
        }
      }

      // Custom pattern validations
      if (field.pattern && value && !field.pattern.test(value)) {
        if (field.name === 'zipCode') {
          return 'Zip Code must be 12345 or 12345-6789.';
        }
        if (field.name === 'email') {
          return 'Please enter a valid email address.';
        }
        if (field.name === 'phone' || field.name === 'emergencyContact') {
          return 'Please enter a valid phone number (10-15 digits, optional +).';
        }
        if (field.name === 'website') {
          return 'Please enter a valid URL (starting with http:// or https://).';
        }
        return `Invalid format for ${field.label}.`;
      }

      // Return empty string if all validations pass
      return '';
    }

    // Main Form Component
    function DynamicForm() {
      // State for form values and errors
      const [formValues, setFormValues] = React.useState(() => {
        const initial = {};
        fieldConfig.forEach(f => { initial[f.name] = ''; });
        return initial;
      });
      const [formErrors, setFormErrors] = React.useState({});
      const [isSubmitting, setIsSubmitting] = React.useState(false);

      // Handle input change
      const handleChange = (e, field) => {
        const { name, value } = e.target;
        setFormValues(prev => ({ ...prev, [name]: value }));
        const error = validateField(field, value);
        setFormErrors(prev => ({ ...prev, [name]: error }));
        
        if (error) {
          Swal.fire({
            title: 'Validation Error',
            text: error,
            icon: 'error',
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
          });
        }
      };

      // Handle form submit
      const handleSubmit = async (e) => {
        e.preventDefault();
        let errors = {};
        fieldConfig.forEach(field => {
          const error = validateField(field, formValues[field.name]);
          if (error) errors[field.name] = error;
        });
        setFormErrors(errors);

        if (Object.keys(errors).length === 0) {
          setIsSubmitting(true);
          
          // Simulate API call
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          Swal.fire({
            title: 'Success!',
            text: 'Form submitted successfully! ðŸŽ‰',
            icon: 'success',
            confirmButtonColor: '#1976d2'
          });
          
          setFormValues(fieldConfig.reduce((acc, f) => ({ ...acc, [f.name]: '' }), {}));
          setIsSubmitting(false);
        } else {
          Swal.fire({
            title: 'Error!',
            text: 'Please fix the errors in the form',
            icon: 'error',
            confirmButtonColor: '#1976d2'
          });
        }
      };

      return (
        <div className="form-container">
          <h2 className="form-title">Evil Manager and the Long Form</h2>
          <form onSubmit={handleSubmit} noValidate>
            <div className="form-grid">
              {fieldConfig.map(field => (
                <div key={field.name} className="form-field">
                  {field.type === 'select' ? (
                    <FormControl 
                      fullWidth 
                      error={!!formErrors[field.name]}
                      variant="outlined"
                    >
                      <InputLabel>{field.label}</InputLabel>
                      <Select
                        value={formValues[field.name]}
                        onChange={e => handleChange(e, field)}
                        label={field.label}
                      >
                        <MenuItem value="">
                          <em>Select {field.label}</em>
                        </MenuItem>
                        {field.options.map(opt => (
                          <MenuItem key={opt} value={opt}>{opt}</MenuItem>
                        ))}
                      </Select>
                      {formErrors[field.name] && (
                        <FormHelperText>{formErrors[field.name]}</FormHelperText>
                      )}
                    </FormControl>
                  ) : field.type === 'textarea' ? (
                    <TextField
                      fullWidth
                      multiline
                      rows={4}
                      label={field.label}
                      value={formValues[field.name]}
                      onChange={e => handleChange(e, field)}
                      error={!!formErrors[field.name]}
                      helperText={formErrors[field.name]}
                      variant="outlined"
                      required={field.required}
                    />
                  ) : (
                    <TextField
                      fullWidth
                      type={field.type}
                      label={field.label}
                      value={formValues[field.name]}
                      onChange={e => handleChange(e, field)}
                      error={!!formErrors[field.name]}
                      helperText={formErrors[field.name]}
                      variant="outlined"
                      required={field.required}
                      InputProps={{
                        startAdornment: field.type === 'tel' && (
                          <span className="text-gray-500 mr-2">+</span>
                        )
                      }}
                    />
                  )}
                </div>
              ))}
            </div>
            <Button
              variant="contained"
              color="primary"
              type="submit"
              disabled={isSubmitting}
              className="submit-button"
            >
              {isSubmitting ? (
                <React.Fragment>
                  <span className="loading-spinner"></span>
                  Submitting...
                </React.Fragment>
              ) : (
                'Submit'
              )}
            </Button>
          </form>
        </div>
      );
    }

    // Render the form
    ReactDOM.createRoot(document.getElementById('root')).render(<DynamicForm />);
  </script>
</body>
</html> 